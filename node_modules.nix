{ pkgs }:
let
  extractTo =
    out_path: src:
    pkgs.runCommand "node_modules-${out_path}" { } ''
      mkdir -p $out/${out_path}
      ${pkgs.libarchive}/bin/bsdtar \
        --extract \
        --file "${src}" \
        --directory $out/${out_path} \
        --strip-components=1 \
        --no-same-owner \
        --no-same-permissions
      chmod -R a+X $out/${out_path}
    '';
  copyTo =
    out_path: src:
    pkgs.runCommand "node_modules-${out_path}" { } ''
      mkdir -p $out
      cp -Lr ${src}/ $out/${out_path}
    '';
in
pkgs.symlinkJoin {
  name = "node_modules";
  paths = [
    (extractTo "jsonc-parser" (
      pkgs.fetchurl {
        url = "https://registry.npmjs.org/jsonc-parser/-/jsonc-parser-3.3.1.tgz";
        hash = "sha512-HUgH65KyejrUFPvHFPbqOY0rsFip3Bo5wb4ngvdi1EpCYWUQDC5V+Y7mZws+DLkr4M//zQJoanu1SP+87Dv1oQ==";
      }
    ))
  ];
}
